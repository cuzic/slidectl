# TDD Development Cycle - 完全実行

このコマンドは、GitHub issueに対してTDD（Test-Driven Development）サイクルの全フェーズを順次実行します。

## 🔄 実行フロー

```
PLAN → RED → GREEN → REFACTOR → VERIFY → DOCUMENT
 📋     🔴     🟢       🔧         ✅         📝
```

各フェーズを順次実行し、ユーザーの承認を得ながら進めます。

---

## Phase 1: PLAN 📋（実装計画）

### 実行内容

1. **Issue の読み込み**
   - ユーザーに issue 番号を確認
   - GitHub issue の内容を取得・表示
   - タスクリストと受入条件を確認
   - 関連ドキュメントを読み込み

2. **実装計画の策定**
   - ファイル構成を決定（どのファイルを作成/変更するか）
   - クラス・関数のインターフェースを設計
   - データ構造を定義（Pydantic モデル等）
   - 依存関係を確認

3. **タスクリストの作成**
   - TodoWrite ツールでタスクを管理
   - 実装順序を決定
   - 各タスクの概要を明確化

4. **テスト計画**
   - テストケースを洗い出す
   - テストファイルの構成を決定
   - 必要なフィクスチャを特定

### 出力

実装計画のサマリーを表示し、ユーザーの承認を得る。

---

## Phase 2: RED 🔴（テストファースト）

### 実行内容

1. **テストファイルの作成**
   - `tests/` ディレクトリに適切な名前でテストファイルを作成
   - 必要なインポートを追加
   - テストクラス・関数の骨組みを作成

2. **失敗するテストの作成**
   - 仕様を明確に定義するテストを書く
   - 正常系のテストケース
   - 異常系のテストケース
   - 境界値のテストケース
   - エラーハンドリングのテストケース

3. **テストの実行と失敗確認**
   - `mise run test` を実行
   - テストが意図通り失敗することを確認
   - 失敗メッセージが適切であることを確認

### 確認ポイント

- テストが作成されたか
- テストが失敗したか（期待通り）
- 失敗メッセージは適切か

ユーザーの確認を得てから次のフェーズへ。

---

## Phase 3: GREEN 🟢（最小実装）

### 実行内容

1. **実装ファイルの作成**
   - `src/slidectl/` に適切なモジュールを作成
   - 必要なインポートを追加
   - クラス・関数の骨組みを作成

2. **最小限の実装**
   - テストをパスするために必要な最小限のコードを書く
   - YAGNI原則（You Aren't Gonna Need It）に従う
   - まずは動作させることを優先

3. **テストの実行とパス確認**
   - `mise run test` を実行
   - すべてのテストがパスすることを確認
   - 既存のテストも壊れていないことを確認

### 確認ポイント

- 実装ファイルが作成されたか
- すべてのテストがパスしたか
- 既存機能を壊していないか

ユーザーの確認を得てから次のフェーズへ。

---

## Phase 4: REFACTOR 🔧（コード改善）

### 実行内容

1. **コードの整理**
   - 重複コードの削除（DRY原則）
   - 長い関数の分割
   - マジックナンバーの定数化
   - 複雑な条件式の簡素化

2. **品質向上**
   - 命名の改善（変数名、関数名、クラス名）
   - 型ヒントの追加・改善
   - ドキュメント文字列の追加
   - 適切なコメントの追加

3. **設計の改善**
   - 関数・クラスの抽出
   - 責任の分離（Single Responsibility Principle）
   - 依存関係の整理
   - インターフェースの明確化

4. **継続的な検証**
   - リファクタリング後に毎回テストを実行
   - すべてのテストがパスすることを確認
   - `mise run lint` でスタイルをチェック

### 確認ポイント

- コードが整理されたか
- テストが通り続けているか
- Lintエラーがないか

ユーザーの確認を得てから次のフェーズへ。

---

## Phase 5: VERIFY ✅（品質確認）

### 実行内容

1. **テスト実行**
   - すべてのテストを実行
   - 失敗するテストがないことを確認

2. **コード品質チェック**
   - `mise run lint` を実行
   - ruff でコードチェック
   - black でフォーマット確認
   - mypy で型チェック

3. **カバレッジ確認**
   - テストカバレッジを測定
   - カバレッジが十分か確認（目標80%以上）
   - 未カバー箇所があれば追加テストを検討

4. **エッジケースの検討**
   - テストされていないケースがないか確認
   - 必要に応じて追加のテストを作成

### チェックリスト

- [ ] すべてのテストがパス
- [ ] Lintエラーがない
- [ ] 型チェックがパス
- [ ] カバレッジが80%以上
- [ ] エッジケースがテストされている

問題があれば該当フェーズに戻って修正。
すべてクリアしたら次のフェーズへ。

---

## Phase 6: DOCUMENT 📝（ドキュメント化とコミット）

### 実行内容

1. **コードドキュメントの追加**
   - モジュールのdocstringを確認・追加
   - クラスのdocstringを確認・追加
   - 関数のdocstringを確認・追加（Args, Returns, Raises, Examples）
   - 複雑な処理にコメントを追加

2. **READMEの更新（必要に応じて）**
   - 新機能を追加した場合は使用例を追加
   - セットアップ手順が変わった場合は更新

3. **変更のコミット**
   - 適切なコミットメッセージを作成
   - 関連issueを参照
   - テストとドキュメントも含める
   - `git add` でステージング
   - `git commit` でコミット

4. **GitHubへプッシュ**
   - `git push origin main` でプッシュ
   - PRを作成（必要に応じて）

5. **Issue の更新**
   - GitHub issue にコメント追加
   - タスクリストにチェック
   - 完了した場合は issue をclose

### 出力

- コミットメッセージ
- Push結果
- Issue更新内容

---

## ✅ サイクル完了

すべてのフェーズが完了したら、次のissueまたは次のタスクに進みます。

---

## 💡 使い方

1. `/tdd` コマンドを実行
2. issue番号を指定（例: #5）
3. 各フェーズを順次実行
4. 各フェーズ終了時にユーザーの承認を得る
5. 問題があれば該当フェーズに戻る
6. すべて完了したらコミット・プッシュ

---

## 🔧 ヒント

### フェーズごとに実行したい場合

個別のスラッシュコマンドも利用可能：
- `/plan` - PLAN フェーズのみ
- `/red` - RED フェーズのみ
- `/green` - GREEN フェーズのみ
- `/refactor` - REFACTOR フェーズのみ
- `/verify` - VERIFY フェーズのみ
- `/document` - DOCUMENT フェーズのみ

### エラーが発生した場合

- **テスト失敗**: GREEN または REFACTOR フェーズに戻る
- **Lintエラー**: REFACTOR フェーズに戻る
- **カバレッジ不足**: RED フェーズに戻って追加テスト作成
- **型エラー**: REFACTOR フェーズに戻って型ヒント修正

---

## 📚 参考資料

- [要件定義](../../docs/requirements.md)
- [技術仕様](../../docs/spec.md)
- [データフロー仕様](../../docs/dataflow.md)
- [GitHub Issues](https://github.com/cuzic/slidectl/issues)
